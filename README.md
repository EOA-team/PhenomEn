# PhenomEn - Phenological monitoring to assess Environmental impacts on Swiss agriculture

This repository is a collection of software generated within the research project "PhenomEn" funded by the [Swiss National Science Foundation](https://snf.ch/en/FKhU9kAtfXx7w9AI/page/home) (grant no. IZCOZ0_198091). At the same time, it is also the collection of software supporting the PhD thesis of [Lukas Valentin Graf](https://github.com/lukasValentin) (@lukasValentin).

## Abstract
Several threats connected to climate change are decreasing the productivity of currently established crops. While we have a conceptual understanding of the interaction of climate and growing patterns, we are in most cases unable to provide quantitative estimates of the magnitude of phenological shifts. Moreover, much of what we know about plant-environment-management interactions comes from controlled experiments that neglect the diversity of our heterogeneous landscapes, where the environment interacts with plant growth. However, understanding these interactions is key to develop short- and long-term adaptation strategies that improve the resilience and sustainability of current farming practices by using appropriate crop rotations as well as crop varieties (genotypes) adapted to the local conditions and by applying the right treatments at the right place, time and intensity.

The PhenomEn project will use the “landscape as a laboratory” and develop an approach that uses remote sensing technologies and geo information science to bridge the gap between ecology and agricultural research. Thereby, it will improve our understanding of plant-​environment interaction under “real world conditions” in the context of agriculture. By building a geospatial phenological database we will examine how combinations of environmental factors can mitigate or amplify climatic threats.
The project will be supported by the activities of the COST action “[Optical synergies for spatiotemporal SENsing of Scalable ECOphysiological traits](https://www.senseco.eu/)" (SENSECO; CA17134) that aims to close spatial and temporal gaps in ecosystem monitoring by improving spatial scaling approaches and time-​series processing.

## Software

The software generated in the project, i.e., during the PhD thesis of [Lukas Valentin Graf](https://github.com/lukasValentin), is listed as [git submodules](https://git-scm.com/book/en/v2/Git-Tools-Submodules) in this repository. Clicking on the directories will redirect you to the actual Github repositories.

The table below lists the single sub-modules, i.e. software components created, their main purpose and license.

| Submodule | Main purpose | Scientific Publication | License |
| --------- | ------------ | ---------------------- | ------- |
| [eodal](https://github.com/EOA-team/eodal) | The Earth Observation Data Analysis Library (EOdal) is the base software to work with (remotely sensed) Earth Observation (EO) data. | [Graf et al., 2022, COMPAG](https://doi.org/10.1016/j.compag.2022.107487) | [GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html) |
| [s2toarup](https://github.com/EOA-team/s2toarup) | Uncertainty propagation from Sentinel-2 top-of-atmosphere radiometry into spectral indices, functional traits, and land surface phenology. | [Graf et al., 2023, IEEE J-STARS](https://doi.org/10.1109/JSTARS.2023.3297713) | [GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html) |
| [sentinel2_crop_traits](https://github.com/EOA-team/sentinel2_crop_traits) | Retrieval of Green Leaf Area Index and Canopy Chlorophyll a+b Content from Sentinel-2 using physiological and phenological priors. | [Graf et al., 2023, RSE](https://doi.org/10.1016/j.rse.2023.113860) | [GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html) |
| [sentinel2_crop_trait_timeseries](https://github.com/EOA-team/sentinel2_crop_trait_timeseries) | Reconstruction of daily Green Leaf Area Index time series from Sentinel-2 observations using a physiologically-sound growth model based on dose-response curves | Under review | [GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html) |
| [rtm_inv](https://github.com/EOA-team/rtm_inv) | Backend-module for running the radiative transfer model in forward-mode to generate lookup-tables and carry out the inversion procedure. Used for [s2toarup](https://github.com/EOA-team/s2toarup), [sentinel2_crop_traits](https://github.com/EOA-team/sentinel2_crop_traits), and [sentinel2_crop_trait_timeseries](https://github.com/EOA-team/sentinel2_crop_trait_timeseries). | Not applicable, see individual references | [GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html) |
| [winter_wheat_phenology](https://github.com/EOA-team/winter_wheat_phenology) | Simulation of heading dates in winter wheat in Switzerland between 1972 and 2020 using the WOFOST crop phenology model | Under preparation by [Raphael Portmann](https://github.com/raphael-portmann/PhenoSwiss) | [GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html) |
| [PhD thesis](https://github.com/lukasValentin/phd_thesis_lukas/tree/main) | Latex source and image files used for writing-up and compiling the PhD thesis submitted to ETH Zurich | [Download the PDF here](https://polybox.ethz.ch/index.php/s/kHM8XbkQ9XhVhxM) | [InC-NC/1.0](https://rightsstatements.org/page/InC-NC/1.0/) |

## Useful Tools I used

- [Easy Leaf Area](https://github.com/lukasValentin/Easy-Leaf-Area/tree/master) is a tool for segmenting green leafs from (soil) background. I used it for the calculation of green canopy cover from smartphone images using the default settings only. The tool uses RGB thresholds and worked quiet well for winter wheat canopies before canopy closure (BBCH 10 to 30). It reproduces well the seasonal pattern of canopy cover in the vegetative and early reproductive phase. Later in the season, the tool had some problems with hotspot effects with images taken around noon. Here, a more advanced model might be necessary or an adaptation of the images or thresholds. Furthermore, I did not test the performance of the tool for senescence estimation.
- [xarray](https://docs.xarray.dev/en/stable/) is a powerful library to work with n-dimensional raster data. Honestly, it took me a while to appreciate its capacities as working with it is not so straightforward and many spatial operations that I consider "standard" do not work out of the box such as access to single pixels. With [rioxarray](https://corteva.github.io/rioxarray/stable/), however, there is a versatile extension of xarray to work with georeferenced image files (cloud optimized GeoTiff). I used xarray many for heavily calculations. For more "GIS"-like applications (intersection of raster and vector data, spatial operations) I still suggest to use EOdal, which I consider more intuitive for people with a background in spatial sciences, as I do.
- [geopandas](https://geopandas.org/en/stable/) is the go-to solution for accessing, reading, modifying and writing geospatial vector data. It is way more convenient than low-level libraries such as fiona or shapefile.
- [cloud-optimized GeoTiff](https://www.cogeo.org/) (COG) should be your default file format. COG is - as its name indicates - optimized for cloud environments, supports chunking which is required for efficient parallel processing, and its compression saves memory and bandwidth.
- [LaTex](https://www.latex-project.org/). Please stop using proprietary formats such as docx for writing your thesis! Not only is not reproducible, you will also have troubles with handling many images, tables and layout options when doing everything in Word or Google Docs. For collaboration, I recommend [Overleaf](https://www.overleaf.com/project)
